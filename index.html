<div id="profileModal" class="modal-overlay hidden">
        <div class="modal-content profile-view">
            <div class="profile-header">
                <span id="pTier" class="tier-badge"></span>
                <button onclick="toggleModal('profileModal')" class="close-x">Ã—</button>
            </div>
            
            <div class="profile-main">
                <div id="pAvatar" class="avatar-circle"></div>
                <h2 id="pName" class="gold-text"></h2>
                <p id="pPhone" class="phone-sub"></p>
            </div>

            <div class="profile-stats-grid">
                <div class="stat-box">
                    <small>CURRENT WALLET</small>
                    <p id="pPoints" class="gold-text"></p>
                </div>
                <div class="stat-box">
                    <small>TOTAL SPENT</small>
                    <p id="pSpent"></p>
                </div>
            </div>

            <div class="redemption-zone">
                <input id="redeemAmt" type="number" placeholder="Points to redeem">
                <button onclick="processRedemption()" class="btn-secondary full-width" style="border-color: #ff4d4d; color: #ff4d4d;">Apply Redemption</button>
            </div>

            <h3 class="section-title">Activity Timeline</h3>
            <div class="history-list" id="pHistory"></div>
            
            <button onclick="toggleModal('profileModal')" class="btn-primary full-width">Back to Terminal</button>
        </div>
    </div>
<script>
    // ... (Keep existing DB and Render logic) ...

    function processRedemption() {
        const amt = parseFloat(document.getElementById('redeemAmt').value);
        const u = db[activeIndex];

        if (!amt || amt <= 0) {
            alert("Please enter a valid amount.");
            return;
        }

        if (amt > u.pts) {
            alert("Insufficient points! Customer only has " + u.pts.toFixed(0));
            return;
        }

        if (confirm(`Redeem ${amt} points from ${u.name}?`)) {
            db[activeIndex].pts -= amt;
            db[activeIndex].history.push({
                date: new Date().toLocaleDateString(),
                type: 'Redemption (Used)',
                amt: -amt
            });
            
            document.getElementById('redeemAmt').value = '';
            render();
            openProfile(activeIndex); // Refresh profile view
        }
    }
    
    // ... (Rest of your script functions) ...
</script>
