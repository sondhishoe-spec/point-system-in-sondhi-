<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sondhi Loyalty Hub</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        :root { --gold: #d4af37; --gold-bright: #f9e29c; --black-bg: #0a0a0a; --black-card: #141414; --border: #2a2a2a; }
        body { background-color: var(--black-bg); color: #fff; font-family: 'Plus Jakarta Sans', sans-serif; margin: 0; }
        .main-header { background: #000; padding: 20px; border-bottom: 1px solid var(--border); position: sticky; top: 0; z-index: 100; }
        .header-container { max-width: 1100px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center; }
        .nav-tabs { display: flex; gap: 10px; background: #111; padding: 5px; border-radius: 10px; border: 1px solid var(--border); }
        .nav-link { padding: 8px 15px; border-radius: 8px; font-size: 12px; cursor: pointer; border: none; background: none; color: #666; font-weight: 600; }
        .nav-link.active { background: var(--gold); color: #000; }
        .view-section { display: none; max-width: 1100px; margin: 30px auto; padding: 0 20px; }
        .view-section.active { display: block; }
        .btn-primary { background: linear-gradient(135deg, var(--gold), var(--gold-bright)); color: #000; border: none; padding: 12px 24px; border-radius: 8px; font-weight: 800; cursor: pointer; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; }
        .card { background: var(--black-card); border: 1px solid var(--border); padding: 20px; border-radius: 15px; cursor: pointer; }
        .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.95); display: flex; align-items: center; justify-content: center; z-index: 1000; }
        .modal-content { background: #111; padding: 25px; border-radius: 20px; width: 90%; max-width: 400px; border: 1px solid var(--border); position: relative; }
        .hidden { display: none; }
        input { width: 100%; background: #1a1a1a; border: 1px solid #333; color: #fff; padding: 12px; margin-bottom: 10px; border-radius: 8px; box-sizing: border-box; }
        .history-list { max-height: 120px; overflow-y: auto; background: #000; border-radius: 10px; margin-top: 15px; font-size: 11px; }
        .history-item { display: flex; justify-content: space-between; padding: 8px; border-bottom: 1px solid #111; }
        .gold-text { color: var(--gold); }
    </style>
</head>
<body>

    <header class="main-header">
        <div class="header-container">
            <h1 style="color:var(--gold); margin:0; font-size:20px;">SONDHI</h1>
            <div class="nav-tabs">
                <button class="nav-link active" onclick="switchView('adminView', this)">Admin</button>
                <button class="nav-link" onclick="switchView('memberView', this)">Member Check</button>
            </div>
        </div>
    </header>

    <section id="adminView" class="view-section active">
        <div style="display:flex; justify-content: space-between; margin-bottom: 20px;">
            <h2>Admin Terminal</h2>
            <button onclick="toggleModal('regModal')" class="btn-primary">+ New Member</button>
        </div>
        <input id="searchBar" type="text" placeholder="Search name or phone..." onkeyup="render()">
        <div id="customerGrid" class="grid"></div>
    </section>

    <section id="memberView" class="view-section">
        <div style="max-width:400px; margin: 40px auto; text-align:center; background:var(--black-card); padding:30px; border-radius:20px; border:1px solid var(--gold);">
            <h2 class="gold-text">My Points</h2>
            <input id="checkPhone" type="text" placeholder="Enter Phone Number">
            <button onclick="checkMyPoints()" class="btn-primary" style="width:100%">Check Now</button>
            <div id="checkResult" class="hidden">
                <h1 id="mPoints" style="font-size:50px; color:var(--gold); margin:20px 0 0 0;">0</h1>
                <p id="mName" style="font-weight:bold;"></p>
            </div>
        </div>
    </section>

    <div id="profileModal" class="modal-overlay hidden">
        <div class="modal-content">
            <button onclick="toggleModal('profileModal')" style="position:absolute; top:15px; right:15px; background:none; border:none; color:#555; font-size:20px;">×</button>
            <h2 id="pName" class="gold-text" style="margin:0;"></h2>
            <p id="pPhone" style="color:#666; font-size:14px;"></p>
            <div style="background:#000; padding:10px; border-radius:10px; margin:15px 0;"><small>TOTAL POINTS</small><br><b id="pPoints" style="font-size:20px;"></b></div>
            <div class="history-list" id="pHistory"></div>
        </div>
    </div>

    <div id="regModal" class="modal-overlay hidden">
        <div class="modal-content">
            <h2 class="gold-text">Register Member</h2>
            <input id="nName" type="text" placeholder="Full Name">
            <input id="nPhone" type="text" placeholder="Phone Number">
            <button onclick="addCust()" class="btn-primary" style="width:100%">Create Account</button>
        </div>
    </div>

    <div id="transModal" class="modal-overlay hidden">
        <div class="modal-content">
            <h2 class="gold-text">Add Bill</h2>
            <input id="billAmount" type="number" placeholder="Enter Amount">
            <button onclick="processPurchase()" class="btn-primary" style="width:100%">Confirm (10% Points)</button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getDatabase, ref, set, onValue, update } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-database.js";

        // ✅ YOUR UPDATED CONFIG FROM THE PHOTO
        const firebaseConfig = {
            apiKey: "AIzaSyC_YAda8x-SNJUyxBW3cJRO4gghbFBs2WA",
            authDomain: "sondhi-loyalty.firebaseapp.com",
            databaseURL: "https://sondhi-loyalty-default-rtdb.firebaseio.com",
            projectId: "sondhi-loyalty",
            storageBucket: "sondhi-loyalty.firebasestorage.app",
            messagingSenderId: "852491541170",
            appId: "1:852491541170:web:09e87f5bc337a052d1c7ab",
            measurementId: "G-Y7E5PZBFP7"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        let customers = [];
        window.activePhone = null;

        onValue(ref(db, 'customers'), (snapshot) => {
            const data = snapshot.val();
            customers = data ? Object.values(data) : [];
            render();
        });

        window.render = function() {
            const grid = document.getElementById('customerGrid');
            const q = document.getElementById('searchBar').value.toLowerCase();
            grid.innerHTML = '';
            customers.forEach((u) => {
                if(u.name.toLowerCase().includes(q) || u.phone.includes(q)) {
                    grid.innerHTML += `<div class="card" onclick="openProfile('${u.phone}')">
                        <h3 style="margin:0;">${u.name}</h3>
                        <p class="gold-text" style="font-size:20px; font-weight:800; margin:10px 0;">${u.pts.toFixed(0)} <small style="color:#555;">PTS</small></p>
                        <button onclick="openTrans('${u.phone}', event)" class="btn-primary" style="width:100%; padding:8px;">Add Bill</button>
                    </div>`;
                }
            });
        };

        window.addCust = function() {
            const n = document.getElementById('nName').value;
            const p = document.getElementById('nPhone').value;
            if(n && p) {
                set(ref(db, 'customers/' + p), { name: n, phone: p, pts: 0, history: [{date: new Date().toLocaleDateString(), type: 'Joined', amt: 0}]});
                toggleModal('regModal');
            }
        };

        window.openProfile = function(phone) {
            window.activePhone = phone;
            const u = customers.find(c => c.phone === phone);
            document.getElementById('pName').innerText = u.name;
            document.getElementById('pPhone').innerText = u.phone;
            document.getElementById('pPoints').innerText = u.pts.toFixed(0);
            document.getElementById('pHistory').innerHTML = u.history.slice().reverse().map(h => `<div class="history-item"><span>${h.date} ${h.type}</span><b>${h.amt >= 0 ? '+' : ''}${h.amt.toFixed(0)}</b></div>`).join('');
            toggleModal('profileModal');
        };

        window.openTrans = function(phone, e) { e.stopPropagation(); window.activePhone = phone; toggleModal('transModal'); };

        window.processPurchase = function() {
            const bill = parseFloat(document.getElementById('billAmount').value);
            const u = customers.find(c => c.phone === window.activePhone);
            if(bill > 0) {
                const earned = bill * 0.10;
                update(ref(db, 'customers/' + u.phone), {
                    pts: u.pts + earned,
                    history: [...u.history, {date: new Date().toLocaleDateString(), type: 'Purchase', amt: earned}]
                });
                toggleModal('transModal');
            }
        };

        window.checkMyPoints = function() {
            const p = document.getElementById('checkPhone').value;
            const u = customers.find(c => c.phone === p);
            if(u) {
                document.getElementById('checkResult').classList.remove('hidden');
                document.getElementById('mPoints').innerText = u.pts.toFixed(0);
                document.getElementById('mName').innerText = u.name;
            } else alert("Number not found!");
        };

        window.switchView = function(view, btn) {
            document.querySelectorAll('.view-section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-link').forEach(b => b.classList.remove('active'));
            document.getElementById(view).classList.add('active');
            btn.classList.add('active');
        };

        window.toggleModal = function(id) { document.getElementById(id).classList.toggle('hidden'); };
    </script>
</body>
</html>
